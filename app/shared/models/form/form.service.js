"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var http_1 = require("@angular/http");
var Rx_1 = require("rxjs/Rx");
require("rxjs/add/operator/do");
require("rxjs/add/operator/map");
var config_1 = require("../../config");
var sqlite_1 = require("../../data/providers/sqlite");
var FormService = (function () {
    function FormService(http, db) {
        this.http = http;
        this.db = db;
        this.id = config_1.Config.guid;
        this.auth = config_1.Config.authToken;
    }
    FormService.prototype.loadPage = function (page_id) {
        var headers = new http_1.Headers();
        headers.append("Content-Type", "application/json");
        console.log(JSON.stringify({
            ID: page_id,
            GUID: this.auth
        }), { headers: headers });
        return this.http.post(config_1.Config.apiUrl + "GetPage", JSON.stringify({
            ID: page_id,
            GUID: this.auth
        }), { headers: headers })
            .map(function (response) {
            var data = response.json();
            data = JSON.parse(data.d);
            console.log("data:" + data);
            return data;
        })
            .catch(this.handleErrors)
            .publishReplay(1)
            .refCount();
    };
    FormService.prototype.loadMenu = function () {
        var headers = new http_1.Headers();
        headers.append("Content-Type", "application/json");
        return this.http.post(config_1.Config.apiUrl + "GetCustomer", JSON.stringify({
            ID: this.id,
            GUID: this.auth
        }), { headers: headers })
            .map(function (response) {
            var menuArray = [];
            var data = response.json();
            var settings = JSON.parse(data.d);
            settings.Menu.MenuItems.forEach(function (item) {
                menuArray.push({
                    id: item.Id, title: item.Title, page_id: item.Page_Id
                });
            });
            return menuArray;
        })
            .catch(this.handleErrors)
            .publishReplay(1)
            .refCount();
    };
    FormService.prototype.submitForm = function (form_id, payLoadJSON) {
        var headers = new http_1.Headers();
        headers.append("Content-Type", "application/json");
        console.log('submitForm');
        if (!config_1.Config.isNetworkAvailable) {
            this.db.addToQueue(form_id, payLoadJSON);
            return;
        }
        //this.db.setForm(form_id, payLoadJSON);
        return this.http.post(config_1.Config.apiUrl + "SaveActionData", payLoadJSON, { headers: headers })
            .map(function (response) {
            console.log('response');
            var data = response.json();
            var submitResponse = JSON.parse(data.d);
            var json = JSON.stringify({
                response: submitResponse
            });
            console.log('response = ' + json);
            return json;
        })
            .catch(this.handleErrors)
            .publishReplay(1)
            .refCount();
    };
    FormService.prototype.handleErrors = function (error) {
        console.log(error.status + ' - ' + JSON.stringify(error.json()));
        return Rx_1.Observable.throw(error);
    };
    return FormService;
}());
FormService = __decorate([
    core_1.Injectable(),
    __metadata("design:paramtypes", [http_1.Http, sqlite_1.Sqlite])
], FormService);
exports.FormService = FormService;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZm9ybS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsc0NBQTJDO0FBQzNDLHNDQUF3RDtBQUN4RCw4QkFBcUM7QUFDckMsZ0NBQThCO0FBQzlCLGlDQUErQjtBQUcvQix1Q0FBcUM7QUFDckMsc0RBQXFEO0FBR3JELElBQWEsV0FBVztJQUlwQixxQkFBb0IsSUFBVSxFQUFVLEVBQVU7UUFBOUIsU0FBSSxHQUFKLElBQUksQ0FBTTtRQUFVLE9BQUUsR0FBRixFQUFFLENBQVE7UUFDOUMsSUFBSSxDQUFDLEVBQUUsR0FBRyxlQUFNLENBQUMsSUFBSSxDQUFDO1FBQ3RCLElBQUksQ0FBQyxJQUFJLEdBQUcsZUFBTSxDQUFDLFNBQVMsQ0FBQztJQUNqQyxDQUFDO0lBRUQsOEJBQVEsR0FBUixVQUFTLE9BQWU7UUFDcEIsSUFBSSxPQUFPLEdBQUcsSUFBSSxjQUFPLEVBQUUsQ0FBQztRQUM1QixPQUFPLENBQUMsTUFBTSxDQUFDLGNBQWMsRUFBRSxrQkFBa0IsQ0FBQyxDQUFDO1FBQ25ELE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQztZQUNuQixFQUFFLEVBQUUsT0FBTztZQUNYLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSTtTQUNsQixDQUFDLEVBQ0YsRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFDLENBQ2xCLENBQUM7UUFDTixNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQ2pCLGVBQU0sQ0FBQyxNQUFNLEdBQUcsU0FBUyxFQUN6QixJQUFJLENBQUMsU0FBUyxDQUFDO1lBQ1gsRUFBRSxFQUFFLE9BQU87WUFDWCxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUk7U0FDbEIsQ0FBQyxFQUNGLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBQyxDQUN0QjthQUNBLEdBQUcsQ0FBQyxVQUFBLFFBQVE7WUFDVCxJQUFJLElBQUks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QUMsQ0FBQztZQUNMLE9BQU8sQ0FBQyxHQUFHLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxDQUFDO1lBRWxDLE1BQU0sQ0FBQyxJQUFJLENBQUM7UUFDaEIsQ0FBQyxDQUFDO2FBQ0QsS0FBSyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUM7YUFDeEIsYUFBYSxDQUFDLENBQUMsQ0FBQzthQUNoQixRQUFRLEVBQUUsQ0FBQztJQUNoQixDQUFDO0lBQ0Qsa0NBQVksR0FBWixVQUFhLEtBQWU7UUFDeEIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFFLEtBQUssR0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDOUQsTUFBTSxDQUFDLGVBQVUsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDbkMsQ0FBQztJQUNMLGtCQUFDO0FBQUQsQ0FBQyxBQXJHRCxJQXFHQztBQXJHWSxXQUFXO0lBRHZCLGlCQUFVLEVBQUU7cUNBS2lCLFdBQUksRUFBYyxlQUFNO0dBSnpDLFdBQVcsQ0FxR3ZCO0FBckdZLGtDQUFXIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XG5pbXBvcnQgeyBIdHRwLCBIZWFkZXJzLCBSZXNwb25zZSB9IGZyb20gXCJAYW5ndWxhci9odHRwXCI7XG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSBcInJ4anMvUnhcIjtcbmltcG9ydCBcInJ4anMvYWRkL29wZXJhdG9yL2RvXCI7XG5pbXBvcnQgXCJyeGpzL2FkZC9vcGVyYXRvci9tYXBcIjtcblxuaW1wb3J0IHsgRm9ybSB9IGZyb20gXCIuL2Zvcm1cIlxuaW1wb3J0IHsgQ29uZmlnIH0gZnJvbSBcIi4uLy4uL2NvbmZpZ1wiXG5pbXBvcnQgeyBTcWxpdGUgfSBmcm9tIFwiLi4vLi4vZGF0YS9wcm92aWRlcnMvc3FsaXRlXCI7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBGb3JtU2VydmljZSB7XG4gICAgcHJpdmF0ZSBpZDogYW55O1xuICAgIHByaXZhdGUgYXV0aDogYW55O1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBodHRwOiBIdHRwLCBwcml2YXRlIGRiOiBTcWxpdGUpeyBcbiAgICAgICAgdGhpcy5pZCA9IENvbmZpZy5ndWlkO1xuICAgICAgICB0aGlzLmF1dGggPSBDb25maWcuYXV0aFRva2VuO1xuICAgIH1cbiAgICBcbiAgICBsb2FkUGFnZShwYWdlX2lkOiBOdW1iZXIpe1xuICAgICAgICBsZXQgaGVhZGVycyA9IG5ldyBIZWFkZXJzKCk7XG4gICAgICAgIGhlYWRlcnMuYXBwZW5kKFwiQ29udGVudC1UeXBlXCIsIFwiYXBwbGljYXRpb24vanNvblwiKTtcbiAgICAgICAgY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgICAgIElEOiBwYWdlX2lkLFxuICAgICAgICAgICAgICAgIEdVSUQ6IHRoaXMuYXV0aFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICB7IGhlYWRlcnM6IGhlYWRlcnN9XG4gICAgICAgICAgICApO1xuICAgICAgICByZXR1cm4gdGhpcy5odHRwLnBvc3QoXG4gICAgICAgICAgICBDb25maWcuYXBpVXJsICsgXCJHZXRQYWdlXCIsXG4gICAgICAgICAgICBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgICAgSUQ6IHBhZ2VfaWQsXG4gICAgICAgICAgICAgICAgR1VJRDogdGhpcy5hdXRoXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIHsgaGVhZGVyczogaGVhZGVyc31cbiAgICAgICAgKVxuICAgICAgICAubWFwKHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgIGxldCBkYXRhID0gcmVzcG9uc2UuanNvbigpO1xuICAgICAgICAgICAgZGF0YSA9IEpTT04ucGFyc2UoZGF0YS5kKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZGF0YTpcIiArIGRhdGEpO1xuXG4gICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKHRoaXMuaGFuZGxlRXJyb3JzKVxuICAgICAgICAucHVibGlzaFJlcGxheSgxKVxuICAgICAgICAucmVmQ291bnQoKTtcbiAgICB9XG5cbiAgICBsb2FkTWVudSgpe1xuICAgICAgICBsZXQgaGVhZGVycyA9IG5ldyBIZWFkZXJzKCk7XG4gICAgICAgIGhlYWRlcnMuYXBwZW5kKFwiQ29udGVudC1UeXBlXCIsIFwiYXBwbGljYXRpb24vanNvblwiKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5wb3N0KFxuICAgICAgICAgICAgQ29uZmlnLmFwaVVybCArIFwiR2V0Q3VzdG9tZXJcIixcbiAgICAgICAgICAgIEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgICAgICBJRDogdGhpcy5pZCxcbiAgICAgICAgICAgICAgICBHVUlEOiB0aGlzLmF1dGhcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgeyBoZWFkZXJzOiBoZWFkZXJzfVxuICAgICAgICApXG4gICAgICAgIC5tYXAocmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgbGV0IG1lbnVBcnJheSA9IFtdO1xuICAgICAgICAgICAgbGV0IGRhdGEgPSByZXNwb25zZS5qc29uKCk7XG4gICAgICAgICAgICBsZXQgc2V0dGluZ3MgPSBKU09OLnBhcnNlKGRhdGEuZCk7XG4gICAgICAgICAgICBzZXR0aW5ncy5NZW51Lk1lbnVJdGVtcy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICAgICAgICAgICAgbWVudUFycmF5LnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBpZDppdGVtLklkLHRpdGxlOml0ZW0uVGl0bGUscGFnZV9pZDppdGVtLlBhZ2VfSWRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIG1lbnVBcnJheTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKHRoaXMuaGFuZGxlRXJyb3JzKVxuICAgICAgICAucHVibGlzaFJlcGxheSgxKVxuICAgICAgICAucmVmQ291bnQoKTtcbiAgICB9XG5cbiAgICBzdWJtaXRGb3JtKGZvcm1faWQsIHBheUxvYWRKU09OKXtcbiAgICAgICAgbGV0IGhlYWRlcnMgPSBuZXcgSGVhZGVycygpO1xuICAgICAgICBoZWFkZXJzLmFwcGVuZChcIkNvbnRlbnQtVHlwZVwiLCBcImFwcGxpY2F0aW9uL2pzb25cIik7XG4gICAgICAgIGNvbnNvbGUubG9nKCdzdWJtaXRGb3JtJyk7XG5cbiAgICAgICAgaWYoIUNvbmZpZy5pc05ldHdvcmtBdmFpbGFibGUpIHtcbiAgICAgICAgICAgIHRoaXMuZGIuYWRkVG9RdWV1ZShmb3JtX2lkLCBwYXlMb2FkSlNPTik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy90aGlzLmRiLnNldEZvcm0oZm9ybV9pZCwgcGF5TG9hZEpTT04pO1xuICAgICAgICByZXR1cm4gdGhpcy5odHRwLnBvc3QoXG4gICAgICAgICAgICBDb25maWcuYXBpVXJsICsgXCJTYXZlQWN0aW9uRGF0YVwiLFxuICAgICAgICAgICAgcGF5TG9hZEpTT04sXG4gICAgICAgICAgICB7IGhlYWRlcnM6IGhlYWRlcnN9XG4gICAgICAgIClcbiAgICAgICAgLm1hcChyZXNwb25zZSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygncmVzcG9uc2UnKTtcbiAgICAgICAgICAgIGxldCBkYXRhID0gcmVzcG9uc2UuanNvbigpO1xuICAgICAgICAgICAgbGV0IHN1Ym1pdFJlc3BvbnNlID0gSlNPTi5wYXJzZShkYXRhLmQpO1xuXG4gICAgICAgIFxuICAgICAgICAgICAgbGV0IGpzb246c3RyaW5nID0gSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgICAgIHJlc3BvbnNlOnN1Ym1pdFJlc3BvbnNlXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ3Jlc3BvbnNlID0gJyArIGpzb24pO1xuXG4gICAgICAgICAgICByZXR1cm4ganNvbjtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKHRoaXMuaGFuZGxlRXJyb3JzKVxuICAgICAgICAucHVibGlzaFJlcGxheSgxKVxuICAgICAgICAucmVmQ291bnQoKTtcbiAgICB9XG4gICAgaGFuZGxlRXJyb3JzKGVycm9yOiBSZXNwb25zZSl7XG4gICAgICAgIGNvbnNvbGUubG9nKGVycm9yLnN0YXR1cyArJyAtICcrSlNPTi5zdHJpbmdpZnkoZXJyb3IuanNvbigpKSk7XG4gICAgICAgIHJldHVybiBPYnNlcnZhYmxlLnRocm93KGVycm9yKTtcbiAgICB9XG59Il19